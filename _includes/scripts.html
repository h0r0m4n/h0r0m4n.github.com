{% if jekyll.environment == "production" %}
    <script src="https://getinsights.io/static/js/insights.js"></script>
    <script>
        insights.init('HugAu_grV5lB5OQI');
        insights.trackPages();
    </script>
{% endif %}

<script>
    // ------------------------------------------------------------------------------
    // CHECK FOR PASSWORD
    // ------------------------------------------------------------------------------
    // If user click featuredLink:
    // Check for localStorage
    //   a. If there’s no password then display a <Modal>
    //      1. User insert a correct password then localStorage is === to true
    //      2. User insert wrong password > Warning
    //   b. If there’s a password then procede to url
    // ------------------------------------------------------------------------------
    var featuredLink = document.querySelectorAll('.featured');
    var featuredWork = 'FeaturedWork';
    var featuredModal = document.getElementById("modal");
    var featuredClose = document.getElementById("modal-close");
    var featuredPassword = document.getElementById("modal-password");
    var featuredEnter = document.getElementById("modal-enter");
    var featuredValue = '123456';
    var featuredUrl = '';

    // Close modal
    featuredClose.onclick = function() {
        featuredModal.classList.toggle('open');
        featuredPassword.focus();
    };

    // Check password
    function checkPassword(parentLink) {
        if (featuredPassword.value === featuredValue) {
            localStorage.setItem(featuredWork, true);

            location.href = parentLink;
            console.log('TEST:', parentLink);

            console.log('Submit (You can enter)!', event.target);
            return true;
        } else {
            console.log('Submit (wront password, show error)!');
        }
    };

    document.addEventListener('click', function (event) {
        
        // Only for links with featured class
        if (!event.target.matches('.featured')) return;

        // If has no localstorage
        if (!localStorage.hasOwnProperty(featuredWork)) {

            // Show the <Modal>
            featuredModal.classList.toggle('open');
            featuredPassword.focus();
            
            // Prevent enter the URL
            event.preventDefault();
            console.log('Local storage is OFF! You can’t enter');

            // Save the URL
            featuredUrl = event.target.href;

            // Submit on button
            featuredEnter.addEventListener("click", function (event) {
                checkPassword(featuredUrl);
                console.log('Submit (from button)!');
            });

            // Submit on keyboard enter button
            featuredPassword.addEventListener("keyup", function(event) {
                if (event.keyCode === 13) {
                    featuredEnter.click();
                    checkPassword(featuredUrl);
                    console.log('Submit (from enter)!');
                };
            });
        };
    }, false);

    {% if page.layout == "post" %}
        if (!localStorage.hasOwnProperty(featuredWork)) {
            location.href = '{{ site.url }}';
        }
    {% endif %}
</script>